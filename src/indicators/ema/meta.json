{
  "identity": {
    "id": "ema",
    "label": "EMA (Exponential Moving Average)",
    "tier": "CORE"
  },
  "docs": {
    "category": "Trend",
    "tags": ["Trend", "Moving Average", "Momentum", "Filter"],
    "blurb": "Exponential moving average that weights recent prices more heavily. Commonly used for trend filters and momentum entries.",
    "longSummary": "The Exponential Moving Average (EMA) responds faster to recent price changes than the Simple Moving Average by applying an exponentially decreasing weight to older observations. Traders often use medium/long EMAs as regime filters and shorter EMAs for momentum or breakout signals. Crossovers (e.g., EMA(21) above EMA(50)) and slope conditions (rising/falling) are common. Combining EMA with oscillators like RSI can reduce noise and avoid counter-trend trades.",
    "mathSummary": "EMA_t = α * Price_t + (1 − α) * EMA_{t−1}, where α = 2 / (N + 1).",
    "references": ["https://www.investopedia.com/terms/e/ema.asp"]
  },
  "params": {
    "length": {
      "type": "number",
      "label": "Length",
      "default": 50,
      "min": 1,
      "max": 500,
      "step": 1,
      "unit": "bars"
    },
    "source": {
      "type": "enum",
      "label": "Price Source",
      "enum": ["close", "open", "high", "low", "hl2", "ohlc4"],
      "default": "close"
    }
  },
  "outputs": ["value"],
  "supportedOperators": [">", ">=", "<", "<=", "==", "crosses_above", "crosses_below", "rising", "falling", "within", "outside"],
  "signals": [
    {
      "id": "ema_rising",
      "label": "EMA rising",
      "direction": "bullish",
      "when": { "left": "value", "operator": "rising", "right": 0 }
    },
    {
      "id": "ema_falling",
      "label": "EMA falling",
      "direction": "bearish",
      "when": { "left": "value", "operator": "falling", "right": 0 }
    }
  ],
  "ui": {
    "tooltips": {
      "_indicator": "EMA emphasizes recent prices and reacts quicker than SMA. Useful as a trend filter or momentum trigger.",
      "length": "Lookback window for the EMA calculation.",
      "source": "Price input used to compute the EMA."
    }
  },
  "constraints": {
    "recommendedTimeframes": ["5m", "15m", "1h", "4h", "1d"]
  },
  "examples": [
    { "name": "EMA Trend Filter (Conservative)", "presetRef": "ema_normal_filter_conservative" },
    { "name": "EMA Pullback (Balanced)", "presetRef": "ema_normal_pullback_balanced" },
    { "name": "EMA Breakout (Aggressive)", "presetRef": "ema_normal_breakout_aggressive" },
    { "name": "EMA Hero: Crossover Pro", "presetRef": "ema_hero_crossover_pro" },
    { "name": "EMA Sequence: Breakout → Retest (Balanced)", "presetRef": "ema_sequence_breakout_retest_balanced" },
    { "name": "EMA Sequence: Sweep → Reclaim (Aggressive)", "presetRef": "ema_sequence_sweep_reclaim_aggressive" }
  ],
  "riskTemplates": {
    "atrStop": {
      "enabledDefault": false,
      "tooltip": "Protective stop sized by ATR multiple.",
      "atrPeriodDefault": 14,
      "atrMultDefault": 2.0
    },
    "trailingTP": {
      "enabledDefault": false,
      "tooltip": "Trail profits after price moves favorably.",
      "modeDefault": "percent",
      "stepPctDefault": 1.0,
      "takeProfitStepsDefault": [25, 50, 75]
    },
    "breakeven": {
      "enabledDefault": false,
      "tooltip": "Move stop to breakeven after reaching a chosen R multiple.",
      "triggerRRDefault": 1.0,
      "offsetPctDefault": 0.1
    },
    "timeStop": {
      "enabledDefault": false,
      "tooltip": "Exit after a fixed number of bars.",
      "barsDefault": 288
    }
  },
  "presets": [
    {
      "id": "ema_normal_filter_conservative",
      "label": "EMA Trend Filter (Conservative)",
      "presetTier": "Normal",
      "riskProfile": "Conservative",
      "designIntent": "Filter",
      "extras": [],
      "indicators": [
        { "id": "ema", "alias": "ema200", "params": { "length": 200 } },
        { "id": "rsi", "alias": "rsi14", "params": { "length": 14, "midline": 50 } }
      ],
      "entry": {
        "group": { "mode": "ALL" },
        "rules": [
          {
            "id": "price_above_ema200",
            "label": "Price > EMA200",
            "when": { "left": { "ref": "price.close" }, "operator": ">", "right": { "ref": "ema200.value" } }
          },
          {
            "id": "rsi_above_50",
            "label": "RSI > 50",
            "when": { "left": { "ref": "rsi14.value" }, "operator": ">", "right": 50 }
          }
        ]
      },
      "riskDefaults": {
        "exits": { "defaultSLPct": 3, "defaultTPPct": 6 },
        "breakeven": { "enabled": false },
        "trailingTP": { "enabled": false },
        "atrStop": { "enabled": false },
        "timeStop": { "enabled": false }
      }
    },
    {
      "id": "ema_normal_pullback_balanced",
      "label": "EMA Pullback (Balanced)",
      "presetTier": "Normal",
      "riskProfile": "Balanced",
      "designIntent": "Pullback",
      "extras": [],
      "indicators": [
        { "id": "ema", "alias": "ema50", "params": { "length": 50 } },
        { "id": "rsi", "alias": "rsi14", "params": { "length": 14, "midline": 50 } }
      ],
      "entry": {
        "group": { "mode": "K_OF_N", "k": 2 },
        "rules": [
          {
            "id": "ema50_rising",
            "label": "EMA50 rising",
            "when": { "left": { "ref": "ema50.value" }, "operator": "rising", "right": 0 }
          },
          {
            "id": "close_above_ema50",
            "label": "Close > EMA50",
            "when": { "left": { "ref": "price.close" }, "operator": ">", "right": { "ref": "ema50.value" } }
          },
          {
            "id": "rsi_midline_confirm",
            "label": "RSI > 50",
            "when": { "left": { "ref": "rsi14.value" }, "operator": ">", "right": 50 }
          }
        ]
      },
      "riskDefaults": {
        "exits": { "defaultSLPct": 5, "defaultTPPct": 10 },
        "breakeven": { "enabled": true, "offsetPct": 0.1 },
        "trailingTP": { "enabled": false },
        "atrStop": { "enabled": false },
        "timeStop": { "enabled": false }
      }
    },
    {
      "id": "ema_normal_breakout_aggressive",
      "label": "EMA Breakout (Aggressive)",
      "presetTier": "Normal",
      "riskProfile": "Aggressive",
      "designIntent": "Breakout",
      "extras": [],
      "indicators": [
        { "id": "ema", "alias": "ema21", "params": { "length": 21 } },
        { "id": "sma", "alias": "sma200", "params": { "length": 200 } }
      ],
      "entry": {
        "group": { "mode": "ALL" },
        "rules": [
          {
            "id": "ema21_crosses_above_sma200",
            "label": "EMA21 crosses above SMA200",
            "when": { "left": { "ref": "ema21.value" }, "operator": "crosses_above", "right": { "ref": "sma200.value" } }
          },
          {
            "id": "ema21_rising",
            "label": "EMA21 rising",
            "when": { "left": { "ref": "ema21.value" }, "operator": "rising", "right": 0 }
          }
        ]
      },
      "riskDefaults": {
        "exits": { "defaultSLPct": 7, "defaultTPPct": 14 },
        "breakeven": { "enabled": false },
        "trailingTP": { "enabled": true, "mode": "percent", "valuePct": 1.0 },
        "atrStop": { "enabled": false },
        "timeStop": { "enabled": false }
      }
    },
    {
      "id": "ema_hero_regime_confirm",
      "label": "EMA Hero: Regime + Confirmation",
      "presetTier": "Hero",
      "riskProfile": "Conservative",
      "designIntent": "Filter",
      "extras": ["regimeFilter", "confirmationIndicator"],
      "cooldownBars": 2,
      "indicators": [
        { "id": "ema", "alias": "ema200", "params": { "length": 200 } },
        { "id": "rsi", "alias": "rsi14", "params": { "length": 14, "midline": 50 } }
      ],
      "entry": {
        "group": { "mode": "ALL" },
        "rules": [
          {
            "id": "price_above_ema200_regime",
            "label": "Price > EMA200",
            "when": { "left": { "ref": "price.close" }, "operator": ">", "right": { "ref": "ema200.value" } }
          },
          {
            "id": "rsi_above_50_confirm",
            "label": "RSI > 50",
            "when": { "left": { "ref": "rsi14.value" }, "operator": ">", "right": 50 }
          }
        ]
      },
      "riskDefaults": {
        "exits": { "defaultSLPct": 3.5, "defaultTPPct": 7 },
        "breakeven": { "enabled": true, "offsetPct": 0.1 },
        "trailingTP": { "enabled": false },
        "atrStop": { "enabled": false },
        "timeStop": { "enabled": false }
      }
    },
    {
      "id": "ema_hero_momentum_mtf",
      "label": "EMA Hero: Momentum MTF",
      "presetTier": "Hero",
      "riskProfile": "Aggressive",
      "designIntent": "Momentum",
      "extras": ["multiTFConfirm", "confirmationIndicator"],
      "cooldownBars": 0,
      "indicators": [
        { "id": "ema", "alias": "ema50", "params": { "length": 50 } },
        { "id": "rsi", "alias": "rsi12", "params": { "length": 12, "midline": 50 } }
      ],
      "entry": {
        "group": { "mode": "K_OF_N", "k": 2 },
        "rules": [
          {
            "id": "ema50_rising_mtf",
            "label": "EMA50 rising",
            "when": { "left": { "ref": "ema50.value" }, "operator": "rising", "right": 0 }
          },
          {
            "id": "price_above_ema50_mtf",
            "label": "Price > EMA50",
            "when": { "left": { "ref": "price.close" }, "operator": ">", "right": { "ref": "ema50.value" } }
          },
          {
            "id": "rsi12_above_50_mtf",
            "label": "RSI(12) > 50",
            "when": { "left": { "ref": "rsi12.value" }, "operator": ">", "right": 50 }
          }
        ]
      },
      "riskDefaults": {
        "exits": { "defaultSLPct": 6, "defaultTPPct": 12 },
        "breakeven": { "enabled": false },
        "trailingTP": { "enabled": true, "mode": "percent", "valuePct": 1.0 },
        "atrStop": { "enabled": false },
        "timeStop": { "enabled": false }
      }
    },
    {
      "id": "ema_hero_crossover_pro",
      "label": "EMA Hero: Crossover Pro",
      "presetTier": "Hero",
      "riskProfile": "Balanced",
      "designIntent": "Momentum",
      "extras": ["signalCooldown", "priority"],
      "cooldownBars": 5,
      "indicators": [
        { "id": "ema", "alias": "ema21", "params": { "length": 21 } },
        { "id": "sma", "alias": "sma50", "params": { "length": 50 } },
        { "id": "rsi", "alias": "rsi14", "params": { "length": 14 } }
      ],
      "entry": {
        "group": { "mode": "ALL" },
        "rules": [
          {
            "id": "ema21_crosses_above_sma50",
            "label": "EMA21 crosses above SMA50",
            "when": { "left": { "ref": "ema21.value" }, "operator": "crosses_above", "right": { "ref": "sma50.value" } }
          },
          {
            "id": "rsi14_above_50",
            "label": "RSI > 50",
            "when": { "left": { "ref": "rsi14.value" }, "operator": ">", "right": 50 }
          }
        ]
      },
      "riskDefaults": {
        "exits": { "defaultSLPct": 4.5, "defaultTPPct": 9 },
        "breakeven": { "enabled": true, "offsetPct": 0.1 },
        "trailingTP": { "enabled": false },
        "atrStop": { "enabled": false },
        "timeStop": { "enabled": false }
      }
    },
    {
      "id": "ema_sequence_breakout_retest_balanced",
      "label": "EMA Sequence: Breakout → Retest (Balanced)",
      "presetTier": "Hero",
      "riskProfile": "Balanced",
      "designIntent": "Breakout",
      "extras": ["signalCooldown"],
      "cooldownBars": 3,
      "indicators": [
        { "id": "donchian_channels", "alias": "donch20", "params": { "length": 20 } },
        { "id": "ema", "alias": "ema50", "params": { "length": 50 } }
      ],
      "entry": {
        "group": { "mode": "ALL" },
        "rules": [
          {
            "id": "breaks_upper",
            "label": "Close crosses above Donchian Upper",
            "when": { "left": { "ref": "price.close" }, "operator": "crosses_above", "right": { "ref": "donch20.upper" } }
          },
          {
            "id": "retest_holds",
            "label": "Close >= Donchian Upper (retest/hold)",
            "when": { "left": { "ref": "price.close" }, "operator": ">=", "right": { "ref": "donch20.upper" } }
          },
          {
            "id": "ema50_rising_seq",
            "label": "EMA50 rising",
            "when": { "left": { "ref": "ema50.value" }, "operator": "rising", "right": 0 }
          }
        ],
        "sequence": { "enabled": true, "ruleAId": "breaks_upper", "ruleBId": "retest_holds", "withinBars": 3 }
      },
      "riskDefaults": {
        "exits": { "defaultSLPct": 5, "defaultTPPct": 10 },
        "breakeven": { "enabled": true, "offsetPct": 0.1 },
        "trailingTP": { "enabled": true, "mode": "percent", "valuePct": 0.8 },
        "atrStop": { "enabled": false },
        "timeStop": { "enabled": false }
      }
    },
    {
      "id": "ema_sequence_sweep_reclaim_aggressive",
      "label": "EMA Sequence: Sweep → Reclaim (Aggressive)",
      "presetTier": "Hero",
      "riskProfile": "Aggressive",
      "designIntent": "Momentum",
      "extras": [],
      "indicators": [
        { "id": "donchian_channels", "alias": "donch20", "params": { "length": 20 } },
        { "id": "ema", "alias": "ema21", "params": { "length": 21 } }
      ],
      "entry": {
        "group": { "mode": "K_OF_N", "k": 2 },
        "rules": [
          {
            "id": "sweep_low",
            "label": "Close crosses below Donchian Lower (sweep)",
            "when": { "left": { "ref": "price.close" }, "operator": "crosses_below", "right": { "ref": "donch20.lower" } }
          },
          {
            "id": "reclaim_level",
            "label": "Close crosses back above Donchian Lower (reclaim)",
            "when": { "left": { "ref": "price.close" }, "operator": "crosses_above", "right": { "ref": "donch20.lower" } }
          },
          {
            "id": "ema21_rising_seq",
            "label": "EMA21 rising",
            "when": { "left": { "ref": "ema21.value" }, "operator": "rising", "right": 0 }
          }
        ],
        "sequence": { "enabled": true, "ruleAId": "sweep_low", "ruleBId": "reclaim_level", "withinBars": 2 }
      },
      "riskDefaults": {
        "exits": { "defaultSLPct": 7, "defaultTPPct": 14 },
        "breakeven": { "enabled": false },
        "trailingTP": { "enabled": true, "mode": "percent", "valuePct": 1.2 },
        "atrStop": { "enabled": false },
        "timeStop": { "enabled": false }
      }
    }
  ],
  "deprecated": false
}